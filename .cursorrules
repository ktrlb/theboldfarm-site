The Bold Farm - Cursor Rules

Project Overview
This is a Next.js 15 (App Router) website for The Bold Farm, a Nigerian Dwarf goat farm. It features goat listings, farm information, a shop page (contact-based ordering), and an Admin Dashboard with tools for goats, products, pastures, chores, and image album management.

Tech Stack
- Framework: Next.js 15.4.6 (App Router) with TypeScript
- Styling: Tailwind CSS + Shadcn UI
- Database: Neon (PostgreSQL) via Drizzle ORM (postgres-js driver)
- Storage: Vercel Blob (images)
- Deployment: Vercel (auto-deploy from GitHub `main`)
- Package Manager: npm (even if yarn.lock exists)

Development Workflow
- Always kill running dev servers before starting a new one
  - Check: ps aux | grep "next dev"
  - Kill if needed, then run: npm run dev
  - Dev server prefers port 3000; uses 3001 if occupied
- Build and Deploy
  - Always test build before deploy: npm run build
  - Deploy only via git: git add . && git commit -m "msg" && git push origin main
  - Vercel auto-deploys from GitHub main
  - Never deploy directly from local tools

Rendering & Code Standards
- Use TypeScript everywhere; prefer interfaces over types
- Prefer Server Components; use "use client" only for interactive UI/forms/browser APIs
- Follow App Router conventions (server-first data fetching)
- Functional, declarative React components; avoid classes
- Descriptive variable names (e.g., isLoading, hasError)
- Keep code readable; avoid deep nesting; early returns where possible
- Avoid unnecessary try/catch; only handle errors meaningfully

Data & API
- Data source of truth: Neon (Postgres) via Drizzle ORM
- Never use mock/local JSON data
- All read/write operations go through Next.js API routes
  - Goats: /api/goats, /api/goats/[id]
  - Products: /api/products, /api/products/[id]
  - Pastures: /api/pastures, /api/pastures/[id]
  - Rotations: /api/rotations, /api/rotations/[id]
  - Observations: /api/observations
  - Rest Periods: /api/rest-periods, /api/rest-periods/[id]
  - Albums: /api/albums, /api/albums/[id]
  - Property Map: /api/property-map
- Images are stored in Vercel Blob; no direct DB blobs
- Database client initialization must be lazy (runtime-only) to avoid Vercel resource provisioning during build
  - See: src/lib/db/client.ts (Proxy-based, on-demand init)

Environment Variables
- Database: POSTGRES_URL (or NEON_POSTGRES_DATABASE_URL)
- Vercel Blob: Managed by @vercel/blob; ensure required tokens/vars configured in Vercel Dashboard
- Never hardcode secrets; always use process.env in server-only code

Admin Dashboard Sections
- Goat Management: CRUD for goats, including type filtering
- Product Management: CRUD for products
- Pasture Management:
  - Map view with base layers (OSM, Satellite, Topographic, etc.)
  - Property boundary polygon (single)
  - Pasture polygons (multiple) with custom fields (JSON)
  - Geocoding via OpenStreetMap Nominatim
  - View and Edit modes; Leaflet + leaflet-draw integration
  - Farm location can be hardcoded default; persisted map center/zoom
- Chore Management: CRUD for chores (planned)
- Image Management: Albums + uploads to Vercel Blob; auto-compression on upload

Goat Type System
Use these exact strings everywhere:
- Dairy Doe
- Breeding Buck
- Doeling Kid
- Buckling Kid
- Wether
- Pet Only Doe

Filtering System
- Goats for Sale page: filter by type, only is_for_sale: true
- Animals page: filter by type for all goats
- Keep filter logic consistent; update FILTER_OPTIONS and filtering helpers when types change

Images & Uploads
- Auto-resize/compress to <= 2MB, JPEG output; iterative compression using sharp
- Process uploads sequentially; show progress states (Compressing, Uploading, Complete)
- Use Next Image component for rendering when possible; prefer WebP for static assets

Branding & Design
- Typography:
  - Primary sans-serif: Lato (weights: 300, 400, 700, 900)
    - Use Lato Black (900) for bold, impactful text (e.g., "BOLD" in logo)
    - Default body text: Lato Regular (400)
  - Serif/Display: DM Serif Display (weight: 400)
    - Use for elegant headings and decorative text (e.g., "the" and "farm" in logo)
- Brand Colors (from branding guide):
  - Bold Black: #1A1A1A - primary text color
  - Deep Earth Brown: #3D2817 - earth tones, backgrounds
  - Fresh Sprout Green: #7CB342 - growth elements, sprout icon, green buttons
  - Meadow Green: #A8D08D - supporting green tones
  - Cream: #F5F1E8 - light backgrounds, cards
  - Honey Gold: #E8C547 - CTAs, highlights, accents
  - Sky Blue: #5B9BD5 - atmospheric elements
- Brand Gradients:
  - Growth: Fresh Sprout Green → Meadow Green (sprout icon, green buttons)
  - Earth to Light: Deep Earth Brown → Cream (backgrounds, cards)
  - Golden Hour: Honey Gold → Cream (CTAs, highlights)
  - Atmospheric: Sky Blue → Meadow Green → Honey Gold (hero overlays)
  - Seasonal Spectrum: Fresh Sprout Green → Honey Gold → Sky Blue
- Logo Usage:
  - Full logo: "the BOLD farm" (DM Serif Display for "the"/"farm", Lato Black for "BOLD")
  - Short logo: "BOLD" with sprout in O (Lato Black)
  - Use black text on light backgrounds, white text on dark backgrounds
  - Logo files in /public: theboldfarm_BOLD, theboldfarm_theBOLDfarm (black/white variants)
  - Header/navigation: Use full logo (full={true})
- Design Principles:
  - Clean, modern farm aesthetic
  - Earth tones and natural colors from brand palette
  - Elegant serif for headings, clean sans-serif for body
  - High contrast for readability
  - Use brand gradients for visual interest and depth

Performance & UX
- Mobile-first responsive design
- Orange (#orange-600 / #ea580c) as primary brand color
- Use Suspense for client components; lazy load non-critical features
- Optimize Web Vitals (LCP, CLS, FID)
- Keep bundle sizes lean

Mapping
- Map layers defined in src/lib/map-layers.ts
- Hardcoded farm location in src/lib/farm-location.ts (used for defaults)
- Property map stored via /api/property-map with map_center (JSON) and map_zoom

Drizzle ORM & Schema
- Schema in src/lib/db/schema.ts
- Use JSON columns for custom fields where appropriate
- All migrations handled with drizzle-kit; ensure schema pushed to Neon before relying on tables
- API routes should tolerate missing tables by returning empty arrays where appropriate

Security & Build
- Do not connect to DB during Next build; db client must be lazy
- Keep server-only code out of client bundles
- Validate all API inputs (Zod preferred)

Removed/Not Used
- Supabase: fully removed (no client, no types, no setup)
- Shopify & shopping cart: not used
- Direct e-commerce checkout: not used

Testing Before Deploy
- npm run build
- Fix errors/warnings
- git add . && git commit -m "message" && git push origin main

Notes
- Use nuqs for URL search param state where appropriate
- Follow Next.js docs for Data Fetching, Rendering, and Routing
- Prefer small client components wrapped in Suspense



